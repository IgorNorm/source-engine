name: Build Portal Linux - Binary Only (Launcher)

on: 
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'

      - name: Install Dependencies (CRITICAL)
        # Навіть для бінарника треба ці ліби, щоб пройшла конфігурація
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            build-essential \
            gcc-multilib \
            g++-multilib \
            libsdl2-dev \
            libopenal-dev \
            libjpeg-dev \
            libpng-dev \
            libtiff-dev \
            libwebp-dev \
            libfreetype6-dev \
            libfontconfig1-dev \
            libcurl4-openssl-dev \
            zlib1g-dev \
            libbz2-dev \
            libglu1-mesa-dev \
            libgl1-mesa-dev \
            libx11-dev \
            libxext-dev \
            libxi-dev \
            libxrandr-dev \
            libxrender-dev

      - name: Configure
        run: |
          rm -rf build
          # Конфігурація все одно перевіряє все, тому залежності вище потрібні
          python3 waf configure -T release --build-games=portal --disable-warns
          
          if [ $? -ne 0 ]; then
            echo "--- CONFIG FAILED ---"
            
