      - name: Build (Linux)
        if: matrix.os == 'ubuntu-22.04'
        shell: bash
        run: |
          # Покращений пошук головного CMakeLists.txt
          # Шукаємо файл, який НЕ в папках thirdparty, external, tests або gtest
          CMAKE_PATH=$(find . -maxdepth 3 -name "CMakeLists.txt" \
            -not -path "*/thirdparty/*" \
            -not -path "*/external/*" \
            -not -path "*/tests/*" \
            -not -path "*/gtest/*" | head -n 1 | xargs dirname)
          
          if [ -z "$CMAKE_PATH" ]; then
            echo "КРИТИЧНА ПОМИЛКА: Головний CMakeLists.txt не знайдено!"
            ls -R
            exit 1
          fi
          
          echo "Знайдено головний проект у: $CMAKE_PATH"
          export CMAKE_PREFIX_PATH=/usr/lib/x86_64-linux-gnu/cmake/Qt5
          
          cmake -S "$CMAKE_PATH" -B build -DCMAKE_BUILD_TYPE=Release -Wno-dev
          cmake --build build -j$(nproc)

      - name: Build (Windows)
        if: matrix.os == 'windows-latest'
        shell: pwsh
        run: |
          # Покращений пошук на Windows (ігноруємо сторонні папки)
          $CMakeFile = Get-ChildItem -Recurse -Filter "CMakeLists.txt" | 
            Where-Object { 
              $_.FullName -notlike "*\thirdparty\*" -and 
              $_.FullName -notlike "*\external\*" -and 
              $_.FullName -notlike "*\tests\*" -and
              $_.FullName -notlike "*\build\*"
            } | Select-Object -First 1
          
          if ($null -eq $CMakeFile) {
            Write-Error "Головний CMakeLists.txt не знайдено!"
            exit 1
          }
          
          $CMakePath = $CMakeFile.DirectoryName
          Write-Host "Знайдено головний проект у: $CMakePath"

          cmake -S "$CMakePath" -B build -G "Visual Studio 17 2022" -A x64 -DCMAKE_BUILD_TYPE=Release -Wno-dev
          cmake --build build --config Release
          
